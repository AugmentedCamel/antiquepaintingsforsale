<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galerie</title>
    <!-- Swiss Typography - DM Sans (similar to Helvetica/Akzidenz-Grotesk) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;1,9..40,300;1,9..40,400&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Swiss Design Color Palette */
            --color-bg: #fafafa;
            --color-wall: #f5f5f5;
            --color-text-primary: #1a1a1a;
            --color-text-secondary: #666666;
            --color-text-tertiary: #999999;
            --color-accent: #1a1a1a;
            --color-border: #e5e5e5;

            /* Typography Scale (Swiss proportions) */
            --font-primary: 'DM Sans', -apple-system, BlinkMacSystemFont, 'Helvetica Neue', sans-serif;
            --font-size-xs: 0.6875rem;   /* 11px */
            --font-size-sm: 0.75rem;     /* 12px */
            --font-size-base: 0.875rem;  /* 14px */
            --font-size-md: 1rem;        /* 16px */
            --font-size-lg: 1.125rem;    /* 18px */
            --font-size-xl: 1.5rem;      /* 24px */
            --font-size-2xl: 2rem;       /* 32px */

            /* Spacing (8px grid) */
            --space-1: 8px;
            --space-2: 16px;
            --space-3: 24px;
            --space-4: 32px;
            --space-5: 40px;
            --space-6: 48px;
            --space-8: 64px;
            --space-10: 80px;
            --space-12: 96px;
            --space-16: 128px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            overflow: hidden;
            background: var(--color-bg);
            font-family: var(--font-primary);
            font-weight: 400;
            font-size: var(--font-size-base);
            line-height: 1.5;
            color: var(--color-text-primary);
            cursor: default;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* Navigation Arrows - Swiss minimalist */
        .nav-arrow {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            opacity: 0.5;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nav-arrow:hover {
            opacity: 1;
            transform: translateY(-50%) scale(1.1);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        }

        .nav-arrow.disabled {
            opacity: 0.15;
            pointer-events: none;
        }

        .nav-arrow.left {
            left: var(--space-5);
        }

        .nav-arrow.right {
            right: var(--space-5);
        }

        .nav-arrow svg {
            width: 28px;
            height: 28px;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nav-arrow:hover svg {
            transform: translateX(2px);
        }

        .nav-arrow.left:hover svg {
            transform: translateX(-2px);
        }

        .nav-arrow svg path {
            fill: var(--color-text-primary);
        }

        /* Editorial Layout - Asymmetric Swiss Grid */
        .editorial-title {
            position: fixed;
            bottom: var(--space-6);
            left: var(--space-6);
            z-index: 100;
            pointer-events: none;
        }

        .editorial-title h1 {
            font-size: var(--font-size-xl);
            font-weight: 400;
            color: var(--color-text-primary);
            letter-spacing: -0.01em;
            margin-bottom: var(--space-1);
            line-height: 1.2;
        }

        .editorial-title .artist {
            font-size: var(--font-size-sm);
            font-weight: 300;
            color: var(--color-text-secondary);
            letter-spacing: 0.02em;
        }

        /* Counter - Top Right (Swiss asymmetry) */
        .counter-display {
            position: fixed;
            top: var(--space-5);
            right: var(--space-6);
            z-index: 100;
            pointer-events: none;
            text-align: right;
        }

        .counter-display .current {
            font-size: var(--font-size-2xl);
            font-weight: 300;
            color: var(--color-text-primary);
            letter-spacing: -0.02em;
            line-height: 1;
        }

        .counter-display .divider {
            font-size: var(--font-size-sm);
            font-weight: 300;
            color: var(--color-text-tertiary);
            margin: var(--space-1) 0;
        }

        .counter-display .total {
            font-size: var(--font-size-sm);
            font-weight: 400;
            color: var(--color-text-tertiary);
            letter-spacing: 0.05em;
        }

        /* Details Panel - Swiss Editorial (bottom right asymmetric) */
        .details-panel {
            position: fixed;
            bottom: var(--space-6);
            right: var(--space-6);
            max-width: 320px;
            z-index: 100;
            opacity: 0;
            transform: translateY(var(--space-2));
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
        }

        .details-panel.visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        .details-panel .meta-grid {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: var(--space-1) var(--space-3);
            margin-bottom: var(--space-3);
        }

        .details-panel .meta-label {
            font-size: var(--font-size-xs);
            font-weight: 500;
            color: var(--color-text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .details-panel .meta-value {
            font-size: var(--font-size-sm);
            font-weight: 400;
            color: var(--color-text-primary);
        }

        .details-panel .description {
            font-size: var(--font-size-sm);
            font-weight: 300;
            color: var(--color-text-secondary);
            line-height: 1.6;
            margin-bottom: var(--space-3);
            padding-top: var(--space-3);
            border-top: 1px solid var(--color-border);
        }

        .details-panel .price-row {
            display: flex;
            align-items: baseline;
            justify-content: space-between;
            padding-top: var(--space-3);
            border-top: 1px solid var(--color-border);
        }

        .details-panel .price {
            font-size: var(--font-size-lg);
            font-weight: 400;
            color: var(--color-text-primary);
            letter-spacing: -0.01em;
        }

        .offer-btn {
            background: transparent;
            color: var(--color-text-primary);
            border: 1px solid var(--color-text-primary);
            padding: var(--space-1) var(--space-3);
            font-family: var(--font-primary);
            font-size: var(--font-size-xs);
            font-weight: 500;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .offer-btn:hover {
            background: var(--color-text-primary);
            color: var(--color-bg);
        }

        .highest-offer {
            font-size: var(--font-size-xs);
            color: var(--color-text-tertiary);
            margin-top: var(--space-2);
            text-align: right;
        }

        .highest-offer span {
            color: var(--color-text-secondary);
            font-weight: 500;
        }

        /* Offer Modal - Swiss Editorial */
        .offer-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(250, 250, 250, 0.97);
            z-index: 500;
            justify-content: center;
            align-items: center;
        }

        .offer-modal.active {
            display: flex;
        }

        .offer-modal-content {
            background: var(--color-bg);
            padding: var(--space-6);
            max-width: 380px;
            width: 90%;
            position: relative;
        }

        .offer-modal-close {
            position: absolute;
            top: var(--space-3);
            right: var(--space-3);
            font-size: var(--font-size-lg);
            color: var(--color-text-tertiary);
            cursor: pointer;
            transition: color 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            line-height: 1;
        }

        .offer-modal-close:hover {
            color: var(--color-text-primary);
        }

        .offer-modal h2 {
            font-size: var(--font-size-xs);
            font-weight: 500;
            color: var(--color-text-tertiary);
            letter-spacing: 0.1em;
            text-transform: uppercase;
            margin-bottom: var(--space-4);
        }

        .offer-modal .painting-preview {
            margin-bottom: var(--space-4);
            padding-bottom: var(--space-3);
            border-bottom: 1px solid var(--color-border);
        }

        .offer-modal .painting-preview h3 {
            font-size: var(--font-size-md);
            font-weight: 400;
            color: var(--color-text-primary);
            margin-bottom: var(--space-1);
        }

        .offer-modal .painting-preview p {
            font-size: var(--font-size-sm);
            font-weight: 300;
            color: var(--color-text-secondary);
        }

        .offer-form-group {
            margin-bottom: var(--space-3);
        }

        .offer-form-group label {
            display: block;
            font-size: var(--font-size-xs);
            font-weight: 500;
            color: var(--color-text-tertiary);
            letter-spacing: 0.08em;
            text-transform: uppercase;
            margin-bottom: var(--space-1);
        }

        .offer-form-group input {
            width: 100%;
            padding: var(--space-2);
            background: transparent;
            border: 1px solid var(--color-border);
            color: var(--color-text-primary);
            font-family: var(--font-primary);
            font-size: var(--font-size-base);
            transition: border-color 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .offer-form-group input:focus {
            outline: none;
            border-color: var(--color-text-primary);
        }

        .offer-form-group input::placeholder {
            color: var(--color-text-tertiary);
        }

        .offer-submit-btn {
            width: 100%;
            padding: var(--space-2);
            background: var(--color-text-primary);
            color: var(--color-bg);
            border: 1px solid var(--color-text-primary);
            font-family: var(--font-primary);
            font-size: var(--font-size-xs);
            font-weight: 500;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin-top: var(--space-2);
        }

        .offer-submit-btn:hover {
            background: transparent;
            color: var(--color-text-primary);
        }

        .offer-success {
            text-align: center;
            padding: var(--space-4) 0;
        }

        .offer-success .checkmark {
            font-size: var(--font-size-2xl);
            color: var(--color-text-primary);
            margin-bottom: var(--space-2);
        }

        .offer-success h3 {
            font-size: var(--font-size-md);
            font-weight: 400;
            color: var(--color-text-primary);
            margin-bottom: var(--space-1);
        }

        .offer-success p {
            font-size: var(--font-size-sm);
            font-weight: 300;
            color: var(--color-text-secondary);
            line-height: 1.6;
        }

        .offer-note {
            font-size: var(--font-size-xs);
            color: var(--color-text-tertiary);
            text-align: center;
            margin-top: var(--space-3);
            line-height: 1.5;
        }

        /* Hover zone for details panel - bottom right corner */
        .hover-zone {
            position: fixed;
            bottom: 0;
            right: 0;
            width: 350px;
            height: 250px;
            z-index: 85;
        }

        body.gallery-mode .hover-zone {
            pointer-events: none;
        }

        /* Zoom overlay - Swiss Editorial */
        .zoom-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(250, 250, 250, 0);
            z-index: 200;
            display: flex;
            justify-content: center;
            align-items: center;
            pointer-events: none;
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .zoom-overlay.active {
            background: rgba(250, 250, 250, 0.98);
            pointer-events: auto;
            opacity: 1;
        }

        .zoom-overlay img {
            max-width: 85vw;
            max-height: 75vh;
            object-fit: contain;
            transform: scale(0.97);
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .zoom-overlay.active img {
            transform: scale(1);
        }

        .zoom-close {
            position: absolute;
            top: var(--space-5);
            right: var(--space-6);
            font-size: var(--font-size-xl);
            color: var(--color-text-tertiary);
            cursor: pointer;
            transition: color 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            line-height: 1;
        }

        .zoom-close:hover {
            color: var(--color-text-primary);
        }

        .zoom-info {
            position: absolute;
            bottom: var(--space-6);
            left: var(--space-6);
        }

        .zoom-info h2 {
            font-size: var(--font-size-lg);
            font-weight: 400;
            color: var(--color-text-primary);
            margin-bottom: var(--space-1);
            letter-spacing: -0.01em;
        }

        .zoom-info p {
            font-size: var(--font-size-sm);
            font-weight: 300;
            color: var(--color-text-secondary);
        }

        /* Click hint - subtle, bottom center */
        .click-hint {
            position: fixed;
            bottom: var(--space-3);
            left: 50%;
            transform: translateX(-50%);
            font-size: var(--font-size-xs);
            font-weight: 400;
            color: var(--color-text-tertiary);
            letter-spacing: 0.1em;
            text-transform: uppercase;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 50;
        }

        .click-hint.visible {
            opacity: 0.5;
        }

        /* Loading - Swiss minimal */
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: var(--font-size-xs);
            font-weight: 500;
            color: var(--color-text-tertiary);
            letter-spacing: 0.15em;
            text-transform: uppercase;
            z-index: 300;
        }

        .loading.hidden {
            display: none;
        }

        /* Animation indicator */
        .animating .nav-arrow {
            pointer-events: none;
            opacity: 0.08;
        }

        /* Gallery name - top left (Swiss editorial) */
        .gallery-name {
            position: fixed;
            top: var(--space-5);
            left: var(--space-6);
            z-index: 100;
            cursor: pointer;
            transition: opacity 0.3s ease;
        }

        .gallery-name:hover {
            opacity: 0.6;
        }

        .gallery-name span {
            font-size: var(--font-size-xs);
            font-weight: 500;
            color: var(--color-text-primary);
            letter-spacing: 0.15em;
            text-transform: uppercase;
        }

        .gallery-name .view-all {
            display: block;
            font-size: 10px;
            font-weight: 400;
            letter-spacing: 0.1em;
            color: var(--color-text-secondary);
            margin-top: 4px;
            opacity: 0;
            transform: translateY(-4px);
            transition: all 0.3s ease;
        }

        .gallery-name:hover .view-all {
            opacity: 1;
            transform: translateY(0);
        }

        /* Gallery mode - hide single-view elements */
        body.gallery-mode .nav-arrow,
        body.gallery-mode .editorial-title,
        body.gallery-mode .counter-display,
        body.gallery-mode .details-panel,
        body.gallery-mode .click-hint {
            opacity: 0;
            pointer-events: none;
        }

        body.gallery-mode .gallery-name .view-all {
            opacity: 1;
            transform: translateY(0);
        }

        /* Gallery mode instruction */
        .gallery-instruction {
            position: fixed;
            bottom: var(--space-6);
            left: 50%;
            transform: translateX(-50%);
            font-size: var(--font-size-xs);
            font-weight: 400;
            color: var(--color-text-secondary);
            letter-spacing: 0.1em;
            text-transform: uppercase;
            opacity: 0;
            transition: opacity 0.5s ease;
            pointer-events: none;
        }

        body.gallery-mode .gallery-instruction {
            opacity: 1;
        }

        /* Gallery mode canvas cursor */
        body.gallery-mode #canvas-container {
            cursor: pointer;
        }

        body.gallery-mode.hovering-painting #canvas-container {
            cursor: pointer;
        }

        /* ==================== MOBILE RESPONSIVE ==================== */

        /* Tablet */
        @media (max-width: 1024px) {
            :root {
                --space-6: 24px;
                --font-size-xl: 1.5rem;
            }

            .details-panel {
                max-width: 320px;
                padding: 20px;
            }

            .nav-arrow {
                width: 44px;
                height: 44px;
            }
        }

        /* Mobile */
        @media (max-width: 768px) {
            :root {
                --space-5: 16px;
                --space-6: 20px;
                --font-size-xl: 1.25rem;
                --font-size-lg: 1rem;
            }

            .gallery-name {
                top: var(--space-5);
                left: var(--space-5);
            }

            .gallery-name span {
                font-size: 11px;
            }

            .counter-display {
                top: var(--space-5);
                right: var(--space-5);
            }

            .counter-display .current {
                font-size: 1.5rem;
            }

            .counter-display .total {
                font-size: 0.85rem;
            }

            .editorial-title {
                bottom: var(--space-5);
                left: var(--space-5);
                right: 80px;
            }

            .editorial-title h1 {
                font-size: var(--font-size-lg);
            }

            .nav-arrow {
                width: 44px;
                height: 44px;
                opacity: 0.7;
                background: rgba(255, 255, 255, 0.95);
                box-shadow: 0 2px 12px rgba(0, 0, 0, 0.15);
            }

            .nav-arrow.left {
                left: 12px;
            }

            .nav-arrow.right {
                right: 12px;
            }

            .nav-arrow svg {
                width: 20px;
                height: 20px;
            }

            .nav-arrow:active {
                opacity: 1;
                transform: translateY(-50%) scale(0.95);
            }

            /* Mobile: position text below painting area */
            .editorial-title {
                bottom: auto;
                top: 65%;
                left: var(--space-5);
                right: var(--space-5);
                text-align: center;
            }

            .editorial-title h1 {
                font-size: 1.1rem;
            }

            .editorial-title .artist {
                font-size: 0.85rem;
            }

            /* Details panel - full width on mobile */
            .details-panel {
                right: 0;
                bottom: 0;
                left: 0;
                max-width: 100%;
                border-radius: 16px 16px 0 0;
                padding: 20px;
                transform: translateY(100%);
            }

            .details-panel.visible {
                transform: translateY(0);
            }

            .hover-zone {
                width: 100%;
                height: 80px;
            }

            /* Mobile tap hint */
            .click-hint {
                bottom: 100px;
                font-size: 10px;
            }

            /* Gallery instruction */
            .gallery-instruction {
                bottom: var(--space-5);
                font-size: 10px;
            }

            /* Zoom overlay adjustments */
            .zoom-container {
                padding: 16px;
            }

            .zoom-info h2 {
                font-size: 1.25rem;
            }

            .zoom-close {
                top: 16px;
                right: 16px;
                width: 40px;
                height: 40px;
            }
        }

        /* Small mobile */
        @media (max-width: 480px) {
            .editorial-title h1 {
                font-size: 1rem;
            }

            .details-panel {
                padding: 16px;
            }

            .meta-grid {
                gap: 8px 16px;
            }

            .price-display {
                font-size: 1.25rem;
            }
        }

        /* Touch device - always show nav arrows */
        @media (hover: none) and (pointer: coarse) {
            .nav-arrow {
                opacity: 0.8;
            }

            .nav-arrow:active {
                opacity: 1;
                transform: translateY(-50%) scale(0.9);
            }

            .click-hint {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>

    <div class="loading" id="loading">Loading</div>

    <!-- Gallery Name - Top Left (Click to toggle gallery view) -->
    <div class="gallery-name" id="galleryToggle" onclick="toggleGalleryMode()">
        <span>Galerie</span>
        <span class="view-all" id="viewAllText">View All</span>
    </div>

    <!-- Gallery mode instruction -->
    <div class="gallery-instruction" id="galleryInstruction">
        Click a painting to view
    </div>

    <!-- Counter - Top Right -->
    <div class="counter-display">
        <div class="current" id="currentNum">01</div>
        <div class="divider">—</div>
        <div class="total" id="totalNum">39</div>
    </div>

    <!-- Navigation -->
    <div class="nav-arrow left" onclick="navigate(-1)">
        <svg viewBox="0 0 24 24">
            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
        </svg>
    </div>
    <div class="nav-arrow right" onclick="navigate(1)">
        <svg viewBox="0 0 24 24">
            <path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"/>
        </svg>
    </div>

    <!-- Editorial Title - Bottom Left -->
    <div class="editorial-title">
        <h1 id="paintingTitle">Loading...</h1>
        <p class="artist" id="artistPreview"></p>
    </div>

    <!-- Hover zone for details panel - bottom right corner -->
    <div class="hover-zone" id="hoverZone"></div>

    <!-- Details Panel - Bottom Right (appears on painting hover or corner hover) -->
    <div class="details-panel" id="detailsPanel">
        <div class="meta-grid">
            <span class="meta-label">Year</span>
            <span class="meta-value" id="infoYear">c. 1850</span>
            <span class="meta-label">Medium</span>
            <span class="meta-value" id="infoMedium">Oil on canvas</span>
            <span class="meta-label">Size</span>
            <span class="meta-value" id="infoSize">45 × 60 cm</span>
            <span class="meta-label">Condition</span>
            <span class="meta-value" id="infoCondition">Good</span>
        </div>
        <p class="description" id="infoDescription">A beautiful piece from our collection.</p>
        <div class="price-row">
            <span class="price" id="infoPrice">€ 1,200</span>
            <button class="offer-btn" onclick="openOfferModal()">Inquire</button>
        </div>
        <p class="highest-offer" id="highestOffer"></p>
    </div>

    <!-- Offer Modal -->
    <div class="offer-modal" id="offerModal">
        <div class="offer-modal-content">
            <span class="offer-modal-close" onclick="closeOfferModal()">&times;</span>
            <div id="offerFormContainer">
                <h2>Make an Offer</h2>
                <div class="painting-preview">
                    <h3 id="offerPaintingTitle">Painting Title</h3>
                    <p id="offerPaintingDetails">Artist - Medium</p>
                </div>
                <form id="offerForm" onsubmit="submitOffer(event)">
                    <div class="offer-form-group">
                        <label>Your Email</label>
                        <input type="email" id="offerEmail" placeholder="your@email.com" required>
                    </div>
                    <div class="offer-form-group">
                        <label>Your Offer (EUR)</label>
                        <input type="number" id="offerAmount" placeholder="Enter amount" min="1" required>
                    </div>
                    <div class="offer-form-group">
                        <label>Your Name (optional)</label>
                        <input type="text" id="offerName" placeholder="Your name">
                    </div>
                    <button type="submit" class="offer-submit-btn">Submit Offer</button>
                </form>
                <p class="offer-note">Your offer is not binding. We will contact you to discuss details if your offer is considered.</p>
            </div>
            <div id="offerSuccessContainer" style="display: none;">
                <div class="offer-success">
                    <div class="checkmark">&#10003;</div>
                    <h3>Offer Submitted!</h3>
                    <p>Thank you for your interest. We have received your offer and will contact you at <span id="confirmEmail"></span> if we wish to proceed.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Click hint -->
    <div class="click-hint" id="clickHint">CLICK TO ZOOM</div>

    <!-- Zoom overlay -->
    <div class="zoom-overlay" id="zoomOverlay">
        <span class="zoom-close" onclick="closeZoom()">&times;</span>
        <img id="zoomImage" src="" alt="">
        <div class="zoom-info">
            <h2 id="zoomTitle">Title</h2>
            <p id="zoomDetails">Details</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script>
        // Paintings data - Research conducted January 2026
        // Note: Attributions pending professional authentication
        const paintings = [
            {
                file: "IMG_2653_cropped.png",
                title: "Wooded Landscape with Riders",
                artist: "Circle of Aelbert Cuyp",
                year: "c. 1650-1680",
                medium: "Oil on canvas",
                size: "60 × 45 cm",
                condition: "Good",
                price: "€ 8,500",
                description: "A masterful Dutch Golden Age landscape showing travelers on horseback in a wooded setting. The warm golden light and atmospheric perspective are characteristic of the Cuyp school. Comparable works by Aelbert Cuyp (1620-1691) and Meindert Hobbema (1638-1709) hang in the Rijksmuseum and National Gallery London. Pending authentication."
            },
            {
                file: "IMG_2656_cropped.png",
                title: "Castle Architecture",
                artist: "Unknown",
                year: "19th Century",
                medium: "Etching",
                size: "40 × 35 cm",
                condition: "Very Good",
                price: "€ 450",
                description: "Detailed architectural study of a medieval castle ruins."
            },
            {
                file: "IMG_2666_cropped.png",
                title: "Dutch Canal Scene with Drawbridge",
                artist: "L. Marissa",
                year: "Late 19th Century",
                medium: "Oil on panel",
                size: "35 × 45 cm",
                condition: "Good",
                price: "€ 1,800",
                description: "A charming Dutch village scene with traditional stepped-gable canal houses and a drawbridge. Signed lower right. The composition captures the quintessential character of historic Dutch waterways."
            },
            {
                file: "IMG_2667_cropped.png",
                title: "Harbor View",
                artist: "Unknown",
                year: "19th Century",
                medium: "Drawing",
                size: "30 × 40 cm",
                condition: "Fair",
                price: "€ 350",
                description: "Atmospheric harbor scene with sailing vessels."
            },
            {
                file: "IMG_2668_cropped.png",
                title: "Amsterdam Canal",
                artist: "Unknown Dutch School",
                year: "19th Century",
                medium: "Oil on canvas",
                size: "50 × 40 cm",
                condition: "Good",
                price: "€ 1,500",
                description: "Classic Amsterdam canal view with merchant houses reflecting the city's Golden Age architecture."
            },
            {
                file: "IMG_2672_cropped.png",
                title: "Dutch Harbor with Fishing Boats",
                artist: "Unknown",
                year: "18th Century",
                medium: "Etching",
                size: "45 × 60 cm",
                condition: "Good",
                price: "€ 650",
                description: "Fine etching depicting Dutch fishing vessels in a harbor, likely representing a scene from the former Zuiderzee coastal region."
            },
            {
                file: "IMG_2675_cropped.png",
                title: "Portrait of a Lady with Cigarette",
                artist: "L. Kiingo (attrib.)",
                year: "c. 1925-1935",
                medium: "Oil and mixed media on board",
                size: "70 × 50 cm",
                condition: "Very Good",
                price: "€ 4,500",
                description: "A striking Art Deco portrait in the style of Tamara de Lempicka and Kees van Dongen. The elegant woman holds a cigarette, embodying 1920s sophistication. The distinctive blue-silver palette and cubist-influenced geometric styling reflect the height of European modernism. Signed lower right. The same artist created the companion piece 'Madonna and Child' (IMG_2696)."
            },
            {
                file: "IMG_2676_cropped.png",
                title: "Madonna and Child",
                artist: "Unknown Flemish",
                year: "Mid-20th Century",
                medium: "Enamel on copper tile",
                size: "80 × 60 cm",
                condition: "Good",
                price: "€ 1,800",
                description: "A devotional enamel tile depicting the Virgin Mary with the Christ Child against a deep burgundy ground. The technique suggests Flemish ecclesiastical craftsmanship. Small maker's plaque visible at base."
            },
            {
                file: "IMG_2680_cropped.png",
                title: "View of the Zuiderzee near Enkhuizen",
                artist: "After Simon de Vlieger",
                year: "c. 1750-1780",
                medium: "Copper engraving",
                size: "35 × 50 cm",
                condition: "Good",
                price: "€ 550",
                description: "Fine 18th century maritime engraving showing Dutch sailing vessels on the Zuiderzee between Hoorn and Enkhuizen. These historic VOC (Dutch East India Company) port cities were crucial to Dutch maritime trade. The inscription at bottom documents the specific location."
            },
            {
                file: "IMG_2681_cropped.png",
                title: "Coastal View",
                artist: "Unknown",
                year: "19th Century",
                medium: "Oil on canvas",
                size: "40 × 55 cm",
                condition: "Good",
                price: "€ 1,100",
                description: "Peaceful coastal landscape in the Dutch Romantic tradition."
            },
            {
                file: "IMG_2684_cropped.png",
                title: "Landscape",
                artist: "Unknown",
                year: "19th Century",
                medium: "Oil on canvas",
                size: "45 × 60 cm",
                condition: "Good",
                price: "€ 900",
                description: "Traditional Dutch landscape painting."
            },
            {
                file: "IMG_2685_cropped.png",
                title: "Rural Scene",
                artist: "Unknown",
                year: "19th Century",
                medium: "Oil on canvas",
                size: "55 × 75 cm",
                condition: "Good",
                price: "€ 1,400",
                description: "Idyllic countryside scene."
            },
            {
                file: "IMG_2686_cropped.png",
                title: "Stowe Castle",
                artist: "Unknown British",
                year: "c. 1845",
                medium: "Pencil on paper",
                size: "25 × 30 cm",
                condition: "Very Good",
                price: "€ 400",
                description: "Pencil drawing of Stowe Castle with period inscription. Dated inscription visible at bottom."
            },
            {
                file: "IMG_2689_cropped.png",
                title: "St. Martin's Church, Landshut",
                artist: "Unknown German",
                year: "19th Century",
                medium: "Steel engraving",
                size: "35 × 28 cm",
                condition: "Good",
                price: "€ 350",
                description: "Historical view of the Martinskirche (St. Martin's Church) in Landshut, Bavaria. This Gothic brick church, built 1385-1500, features the world's tallest brick tower at 130.6 meters. Inscribed 'Martinskirche Landshut' at bottom."
            },
            {
                file: "IMG_2692_cropped.png",
                title: "Madonna and Child",
                artist: "Jan Toorop (attrib.)",
                year: "c. 1910-1925",
                medium: "Charcoal and chalk on paper",
                size: "35 × 28 cm",
                condition: "Good",
                price: "€ 12,000",
                description: "A devotional drawing in the distinctive Art Nouveau Symbolist style of Jan Toorop (1858-1928). The flowing linear treatment of the Madonna's hair and veil exemplifies Toorop's signature 'whiplash' style developed from Javanese batik patterns. After his 1905 conversion to Catholicism, Toorop devoted himself to religious subjects. This work shows the characteristic elongated features and mystical quality of his post-conversion period. Authentication recommended through RKD Netherlands Institute for Art History."
            },
            {
                file: "IMG_2695_cropped.png",
                title: "Landscape View",
                artist: "Unknown",
                year: "19th Century",
                medium: "Oil on canvas",
                size: "50 × 70 cm",
                condition: "Good",
                price: "€ 1,300",
                description: "Expansive landscape vista."
            },
            {
                file: "IMG_2696_cropped.png",
                title: "Madonna and Child with Halo",
                artist: "L. Kiingo (attrib.)",
                year: "c. 1925-1935",
                medium: "Oil on canvas",
                size: "55 × 45 cm",
                condition: "Good",
                price: "€ 4,500",
                description: "A modernist religious painting combining Cubist structure with Byzantine iconography. The Madonna holds the Christ Child who bears a small crucifix. The distinctive blue-silver palette and geometric styling match the companion portrait piece (IMG_2675), suggesting the same artist. The fusion of sacred subject matter with Art Deco aesthetics was popular in interwar European art."
            },
            {
                file: "IMG_2699_cropped.png",
                title: "Farmhouse by the Water",
                artist: "Dutch Romantic School",
                year: "c. 1860-1890",
                medium: "Oil on canvas",
                size: "60 × 50 cm",
                condition: "Good",
                price: "€ 2,200",
                description: "A romantic Dutch landscape showing a farmhouse reflected in still water, with a boat moored at the bank. The dappled light through the trees and atmospheric treatment show influence of the Barbizon and Hague School movements. Signed lower left."
            },
            {
                file: "IMG_2703_cropped.png",
                title: "Village Scene",
                artist: "Unknown",
                year: "19th Century",
                medium: "Oil on panel",
                size: "30 × 40 cm",
                condition: "Good",
                price: "€ 750",
                description: "Charming village street scene."
            },
            {
                file: "IMG_2705_cropped.png",
                title: "Castle by the River",
                artist: "German Expressionist School",
                year: "c. 1920-1940",
                medium: "Woodcut print",
                size: "50 × 40 cm",
                condition: "Good",
                price: "€ 800",
                description: "A dramatic expressionist print depicting a medieval castle with angular, dynamic lines characteristic of German Expressionism. The bold contrasts and atmospheric sky show influence of Die Brücke movement. Signed in pencil lower right."
            },
            {
                file: "IMG_2710_cropped.png",
                title: "Figure with Birds",
                artist: "Unknown Expressionist",
                year: "c. 1930-1950",
                medium: "Ink and wash on paper",
                size: "65 × 50 cm",
                condition: "Good",
                price: "€ 1,400",
                description: "An evocative expressionist drawing showing a stylized figure with outstretched arms amid crows or ravens in a stark landscape. The surrealist elements and bold black lines suggest influence of German Expressionism and early Surrealism. The symbolic imagery of birds and moon creates a mystical atmosphere."
            },
            {
                file: "IMG_2711_cropped.png",
                title: "Architectural Study",
                artist: "Unknown",
                year: "19th Century",
                medium: "Drawing",
                size: "40 × 30 cm",
                condition: "Good",
                price: "€ 500",
                description: "Detailed architectural drawing."
            },
            {
                file: "IMG_2713_cropped.png",
                title: "Landscape",
                artist: "Unknown",
                year: "19th Century",
                medium: "Oil on canvas",
                size: "45 × 60 cm",
                condition: "Good",
                price: "€ 1,000",
                description: "Atmospheric landscape."
            },
            {
                file: "IMG_2714_cropped.png",
                title: "Fishing Boats on the Zuiderzee",
                artist: "After Simon de Vlieger",
                year: "c. 1750-1780",
                medium: "Copper engraving",
                size: "40 × 55 cm",
                condition: "Good",
                price: "€ 550",
                description: "Fine 18th century maritime engraving depicting Dutch fishing vessels between Hoorn and Enkhuizen on the former Zuiderzee. Companion piece to IMG_2680. The inscription documents 't Dorp Ooster Leek tusschen Hoorn en Enkhuizen met de Zuider Zee te zien' (The village Oosterleek between Hoorn and Enkhuizen with view of the Zuiderzee)."
            },
            {
                file: "IMG_2715_cropped.png",
                title: "Portrait Study",
                artist: "Unknown",
                year: "19th Century",
                medium: "Oil on canvas",
                size: "55 × 45 cm",
                condition: "Good",
                price: "€ 1,200",
                description: "Character portrait study."
            },
            {
                file: "IMG_2717_cropped.png",
                title: "The Coffin Maker's Workshop",
                artist: "After Jean-Baptiste Greuze",
                year: "Late 18th Century",
                medium: "Stipple engraving",
                size: "35 × 45 cm",
                condition: "Good",
                price: "€ 650",
                description: "A fine stipple engraving depicting a genre scene in an interior workshop. The intimate domestic subject matter and refined technique are characteristic of late 18th century French printmaking."
            },
            {
                file: "IMG_2723_cropped.png",
                title: "Gothic Church Tower",
                artist: "Unknown",
                year: "19th Century",
                medium: "Charcoal on toned paper",
                size: "60 × 45 cm",
                condition: "Good",
                price: "€ 600",
                description: "Atmospheric sketch of a Gothic church tower, possibly Dutch or Belgian. The loose, atmospheric treatment suggests a preparatory study."
            },
            {
                file: "IMG_2724_cropped.png",
                title: "Cathedral View",
                artist: "Unknown",
                year: "19th Century",
                medium: "Drawing",
                size: "50 × 35 cm",
                condition: "Good",
                price: "€ 700",
                description: "Architectural cathedral study."
            },
            {
                file: "IMG_2725_cropped.png",
                title: "Still Life with Tulips",
                artist: "Unknown Dutch",
                year: "20th Century",
                medium: "Oil on panel",
                size: "40 × 50 cm",
                condition: "Good",
                price: "€ 850",
                description: "A dark, mysterious still life of red tulips in a glass vase. The dramatic lighting against the dark background evokes 17th century Dutch still life traditions."
            },
            {
                file: "IMG_2729_cropped.png",
                title: "Landscape",
                artist: "Unknown",
                year: "19th Century",
                medium: "Oil on canvas",
                size: "45 × 60 cm",
                condition: "Good",
                price: "€ 1,000",
                description: "Peaceful countryside landscape."
            },
            {
                file: "IMG_2730_cropped.png",
                title: "Sunflowers in White Vase",
                artist: "R. de Roeck",
                year: "c. 1940-1960",
                medium: "Oil on canvas",
                size: "55 × 45 cm",
                condition: "Very Good",
                price: "€ 1,800",
                description: "A vibrant expressionist still life of sunflowers against a bold red and dark blue ground. Signed 'R. de Roeck' lower right. Possibly connected to the Belgian De Roeck artist family of Antwerp, which included Alfons De Roeck (1896-1982). The expressive brushwork and rich color palette show Post-Impressionist influence."
            },
            {
                file: "IMG_2731_cropped.png",
                title: "Sunflowers",
                artist: "R. de Roeck",
                year: "c. 1940-1960",
                medium: "Oil on canvas",
                size: "50 × 40 cm",
                condition: "Good",
                price: "€ 1,600",
                description: "Companion piece to IMG_2730. Another expressive sunflower composition signed 'R. de Roeck'. The consistent style and subject matter suggest these works are part of a series by the same hand."
            },
            {
                file: "IMG_2732_cropped.png",
                title: "Map of Flanders Provinces",
                artist: "German cartographer",
                year: "19th Century",
                medium: "Steel engraving",
                size: "70 × 55 cm",
                condition: "Good",
                price: "€ 350",
                description: "Historical map showing the provinces of Oost-Vlaanderen (East Flanders) and West-Vlaanderen (West Flanders) in Belgium. The map shows the North Sea coast and borders with France (Frankreich) and the province of Hennegau (Hainaut)."
            },
            {
                file: "IMG_2733_cropped.png",
                title: "Pictorial Map of Hulst",
                artist: "Mark F. Severin",
                year: "1980",
                medium: "Lithograph print",
                size: "50 × 70 cm",
                condition: "Very Good",
                price: "€ 150",
                description: "A decorative illustrated map of Hulst, a fortified town in Zeeland, Netherlands. Created in 1980 as noted in the inscription. The pictorial style shows local landmarks, activities, and the historic star-fort layout of the town. Modern commemorative piece."
            },
            {
                file: "IMG_2736_cropped.png",
                title: "Panoramic View",
                artist: "Unknown",
                year: "19th Century",
                medium: "Oil on canvas",
                size: "60 × 90 cm",
                condition: "Good",
                price: "€ 2,000",
                description: "Wide panoramic landscape."
            },
            {
                file: "IMG_2739_cropped.png",
                title: "Zeelandia Comitatus",
                artist: "Willem Blaeu / Johannes Janssonius",
                year: "c. 1640-1660",
                medium: "Copper engraving with hand coloring",
                size: "50 × 38 cm",
                condition: "Good",
                price: "€ 1,800",
                description: "An important 17th century map of the County of Zeeland from the Dutch Golden Age of cartography. Published by either Willem & Joan Blaeu or their rival Johannes Janssonius, both of Amsterdam. Features decorative cartouches with the Zeeland coat of arms (the lion emerging from water), compass rose, and sailing ships. The Blaeu family were the preeminent cartographers of the era; a complete Blaeu Atlas Major sold for £750,000 in 2015. Individual maps command €400-2,000+ depending on condition and coloring."
            },
            {
                file: "IMG_2741_cropped.png",
                title: "Rotterdam Harbor with Grain Silo",
                artist: "Herman (attrib.)",
                year: "c. 1930-1950",
                medium: "Ink wash and watercolor",
                size: "60 × 50 cm",
                condition: "Good",
                price: "€ 900",
                description: "An industrial harbor scene showing the modernist architecture of Rotterdam's port facilities including a massive grain silo and harbor cranes. The atmospheric wash technique captures the misty, working atmosphere of the port. Partially signed lower right. Documents the industrial heritage of Rotterdam before WWII destruction."
            },
            {
                file: "IMG_2746_cropped.png",
                title: "Landscape",
                artist: "Unknown",
                year: "19th Century",
                medium: "Oil on canvas",
                size: "55 × 75 cm",
                condition: "Good",
                price: "€ 1,500",
                description: "Expansive natural landscape."
            },
            {
                file: "IMG_2748_cropped.png",
                title: "Still Life",
                artist: "Unknown",
                year: "19th Century",
                medium: "Oil on panel",
                size: "30 × 40 cm",
                condition: "Very Good",
                price: "€ 950",
                description: "Intimate still life on panel."
            }
        ];

        // State
        let currentIndex = 0;
        let isAnimating = false;
        let scene, camera, renderer;
        let currentPainting, nextPainting;
        let paintingGroup;
        let textureLoader;
        let loadedTextures = {};
        let spotlight;
        let dynamicLight; // Light that follows cursor
        let raycaster, mouse; // For detecting hover over painting

        // Gallery mode state
        let isGalleryMode = false;
        let galleryGroup; // Group containing all gallery thumbnails
        let galleryPaintings = []; // Array of painting meshes in gallery view
        let galleryWall; // Larger wall for gallery view
        const GALLERY_SPACING = 0.3; // Space between paintings
        const GALLERY_THUMB_SIZE = 1.2; // Max size of thumbnails

        // Responsive gallery columns
        function getGalleryCols() {
            if (window.innerWidth <= 480) return 3;
            if (window.innerWidth <= 768) return 4;
            if (window.innerWidth <= 1024) return 6;
            return 8;
        }

        // Touch/swipe state
        let touchStartX = 0;
        let touchStartY = 0;
        let touchEndX = 0;
        let isSwiping = false;

        // Initialize
        function init() {
            // Scene - Swiss white background
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xfafafa);

            // Camera - pulled back for more breathing room
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100);
            camera.position.set(0, 0, 7);
            camera.lookAt(0, 0, 0);

            // Renderer with optimizations
            renderer = new THREE.WebGLRenderer({
                antialias: true,
                powerPreference: "high-performance"
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            renderer.shadowMap.autoUpdate = false; // Manual shadow update for performance
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            // Texture loader
            textureLoader = new THREE.TextureLoader();

            // Build scene
            createEnvironment();
            createLighting();

            // Create gallery view (loads all thumbnails in background)
            createGalleryView();

            // Load first painting with elegant entrance
            loadPainting(currentIndex, (painting) => {
                currentPainting = painting;
                paintingGroup.add(currentPainting);

                // Subtle reveal animation for first painting
                currentPainting.children[0].material.transparent = true;
                currentPainting.children[0].material.opacity = 0;

                gsap.to(currentPainting.children[0].material, {
                    opacity: 1,
                    duration: 1.2,
                    ease: "power2.out",
                    delay: 0.2
                });

                updateUI();
                document.getElementById('loading').classList.add('hidden');
            });

            // Preload adjacent
            preloadTexture(currentIndex + 1);

            // Events
            setupEvents();

            // Start render loop
            animate();
        }

        function createEnvironment() {
            // Swiss minimal wall - pure white, no texture
            const wallGeometry = new THREE.PlaneGeometry(24, 14);
            const wallMaterial = new THREE.MeshStandardMaterial({
                color: 0xfafafa,
                roughness: 1,
                metalness: 0
            });
            const wall = new THREE.Mesh(wallGeometry, wallMaterial);
            wall.position.z = -0.12; // Closer to painting for tighter shadow
            wall.receiveShadow = true;
            scene.add(wall);

            // Painting group (for animation)
            paintingGroup = new THREE.Group();
            scene.add(paintingGroup);

            // Initialize raycaster for painting hover detection
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();
        }

        function createLighting() {
            // Bright, even ambient light - clean museum lighting
            const ambient = new THREE.AmbientLight(0xffffff, 0.7);
            scene.add(ambient);

            // Dynamic light that follows cursor
            dynamicLight = new THREE.PointLight(0xffffff, 0.6, 20);
            dynamicLight.position.set(0, 2, 4);
            dynamicLight.castShadow = true;
            dynamicLight.shadow.mapSize.width = 1024;
            dynamicLight.shadow.mapSize.height = 1024;
            dynamicLight.shadow.bias = -0.002;
            dynamicLight.shadow.radius = 3; // Soft shadow
            dynamicLight.shadow.camera.near = 0.5;
            dynamicLight.shadow.camera.far = 15;
            scene.add(dynamicLight);

            // Subtle fill light from below to soften shadows
            const fillLight = new THREE.DirectionalLight(0xffffff, 0.15);
            fillLight.position.set(0, -2, 2);
            scene.add(fillLight);
        }

        // ==================== GALLERY MODE ====================

        function createGalleryView() {
            // Create group for gallery thumbnails
            galleryGroup = new THREE.Group();
            galleryGroup.visible = false;
            scene.add(galleryGroup);

            // Create larger wall for gallery view
            const wallGeometry = new THREE.PlaneGeometry(50, 30);
            const wallMaterial = new THREE.MeshStandardMaterial({
                color: 0xfafafa,
                roughness: 1,
                metalness: 0
            });
            galleryWall = new THREE.Mesh(wallGeometry, wallMaterial);
            galleryWall.position.z = -1;
            galleryWall.receiveShadow = true;
            galleryWall.visible = false;
            scene.add(galleryWall);

            // Calculate grid layout (responsive columns)
            const cols = getGalleryCols();
            const totalPaintings = paintings.length;
            const rows = Math.ceil(totalPaintings / cols);
            const gridWidth = cols * (GALLERY_THUMB_SIZE + GALLERY_SPACING) - GALLERY_SPACING;
            const gridHeight = rows * (GALLERY_THUMB_SIZE + GALLERY_SPACING) - GALLERY_SPACING;
            const startX = -gridWidth / 2 + GALLERY_THUMB_SIZE / 2;
            const startY = gridHeight / 2 - GALLERY_THUMB_SIZE / 2;

            // Load all paintings as thumbnails
            paintings.forEach((painting, index) => {
                const col = index % cols;
                const row = Math.floor(index / cols);
                const x = startX + col * (GALLERY_THUMB_SIZE + GALLERY_SPACING);
                const y = startY - row * (GALLERY_THUMB_SIZE + GALLERY_SPACING);

                // Create placeholder while loading
                const placeholderGeom = new THREE.PlaneGeometry(GALLERY_THUMB_SIZE, GALLERY_THUMB_SIZE);
                const placeholderMat = new THREE.MeshStandardMaterial({
                    color: 0xf0f0f0,
                    roughness: 1
                });
                const placeholder = new THREE.Mesh(placeholderGeom, placeholderMat);
                placeholder.position.set(x, y, 0);
                placeholder.userData = { index, isGalleryItem: true };
                galleryGroup.add(placeholder);
                galleryPaintings[index] = placeholder;

                // Load thumbnail texture for gallery (much faster loading)
                const thumbFile = painting.file.replace('_cropped.png', '_cropped.jpg');
                textureLoader.load(`Cropped/thumbs/${thumbFile}`, (texture) => {
                    const aspect = texture.image.width / texture.image.height;
                    let width, height;
                    if (aspect > 1) {
                        width = GALLERY_THUMB_SIZE;
                        height = GALLERY_THUMB_SIZE / aspect;
                    } else {
                        height = GALLERY_THUMB_SIZE;
                        width = GALLERY_THUMB_SIZE * aspect;
                    }

                    // Update geometry and material
                    const newGeom = new THREE.PlaneGeometry(width, height);
                    const newMat = new THREE.MeshStandardMaterial({
                        map: texture,
                        roughness: 0.8
                    });

                    placeholder.geometry.dispose();
                    placeholder.material.dispose();
                    placeholder.geometry = newGeom;
                    placeholder.material = newMat;
                    placeholder.castShadow = true;
                });
            });
        }

        // Rebuild gallery grid when columns change (responsive)
        function rebuildGalleryGrid() {
            if (!galleryGroup) return;

            const cols = getGalleryCols();
            const rows = Math.ceil(paintings.length / cols);
            const gridWidth = cols * (GALLERY_THUMB_SIZE + GALLERY_SPACING) - GALLERY_SPACING;
            const gridHeight = rows * (GALLERY_THUMB_SIZE + GALLERY_SPACING) - GALLERY_SPACING;
            const startX = -gridWidth / 2 + GALLERY_THUMB_SIZE / 2;
            const startY = gridHeight / 2 - GALLERY_THUMB_SIZE / 2;

            // Reposition existing paintings
            galleryPaintings.forEach((painting, index) => {
                if (painting) {
                    const col = index % cols;
                    const row = Math.floor(index / cols);
                    const x = startX + col * (GALLERY_THUMB_SIZE + GALLERY_SPACING);
                    const y = startY - row * (GALLERY_THUMB_SIZE + GALLERY_SPACING);

                    gsap.to(painting.position, {
                        x: x,
                        y: y,
                        duration: 0.5,
                        ease: "power2.out"
                    });
                }
            });

            // Update camera if in gallery mode
            if (isGalleryMode) {
                const cameraZ = Math.max(gridHeight * 1.2, gridWidth * 0.8, 10);
                gsap.to(camera.position, {
                    z: cameraZ,
                    duration: 0.5,
                    ease: "power2.out"
                });
            }
        }

        function toggleGalleryMode() {
            if (isAnimating) return;

            if (isGalleryMode) {
                exitGalleryMode();
            } else {
                enterGalleryMode();
            }
        }

        function enterGalleryMode() {
            if (isAnimating || isGalleryMode) return;
            isAnimating = true;
            isGalleryMode = true;

            document.body.classList.add('gallery-mode');
            document.getElementById('viewAllText').textContent = 'Close';
            document.getElementById('detailsPanel').classList.remove('visible');

            // Disable shadow updates during transition and set neutral light position
            renderer.shadowMap.autoUpdate = false;
            gsap.to(dynamicLight.position, { x: 0, y: 2, duration: 0.5, ease: "power2.out" });

            // Calculate camera position to see all paintings (responsive)
            const cols = getGalleryCols();
            const rows = Math.ceil(paintings.length / cols);
            const gridHeight = rows * (GALLERY_THUMB_SIZE + GALLERY_SPACING);
            const gridWidth = cols * (GALLERY_THUMB_SIZE + GALLERY_SPACING);
            const cameraZ = Math.max(gridHeight * 1.2, gridWidth * 0.8, 10);

            // Show gallery elements
            galleryGroup.visible = true;
            galleryWall.visible = true;

            // Animate current painting out
            if (currentPainting) {
                gsap.to(currentPainting.scale, {
                    x: 0.5,
                    y: 0.5,
                    z: 0.5,
                    duration: 0.6,
                    ease: "power2.inOut"
                });
                gsap.to(currentPainting.children[0].material, {
                    opacity: 0,
                    duration: 0.4,
                    ease: "power2.in"
                });
            }

            // Animate camera zoom out
            gsap.to(camera.position, {
                x: 0,
                y: 0,
                z: cameraZ,
                duration: 1.2,
                ease: "power3.inOut",
                onComplete: () => {
                    if (currentPainting) {
                        currentPainting.visible = false;
                    }
                    isAnimating = false;
                    // Re-enable shadow updates after transition
                    renderer.shadowMap.autoUpdate = false;
                    needsShadowUpdate = true;
                }
            });

            // Fade in gallery items
            galleryPaintings.forEach((painting, i) => {
                if (painting && painting.material) {
                    painting.material.transparent = true;
                    painting.material.opacity = 0;
                    gsap.to(painting.material, {
                        opacity: 1,
                        duration: 0.8,
                        delay: 0.3 + i * 0.02,
                        ease: "power2.out"
                    });
                }
            });

            // Move light back for even gallery lighting
            gsap.to(dynamicLight.position, {
                z: cameraZ - 2,
                duration: 1.2,
                ease: "power3.inOut"
            });
        }

        function exitGalleryMode(targetIndex = null) {
            if (isAnimating || !isGalleryMode) return;
            isAnimating = true;

            // Disable shadow updates during transition and set neutral light position
            renderer.shadowMap.autoUpdate = false;
            gsap.to(dynamicLight.position, { x: 0, y: 2, z: 4, duration: 0.5, ease: "power2.out" });

            document.body.classList.remove('gallery-mode');
            document.getElementById('viewAllText').textContent = 'View All';

            // Update current index if a painting was clicked
            if (targetIndex !== null) {
                currentIndex = targetIndex;
            }

            // Prepare current painting
            if (currentPainting) {
                paintingGroup.remove(currentPainting);
            }

            // Load the target painting
            loadPainting(currentIndex, (painting) => {
                currentPainting = painting;
                currentPainting.visible = false;
                paintingGroup.add(currentPainting);

                // Get the gallery thumbnail position for smooth transition
                const thumbPos = galleryPaintings[currentIndex]?.position || { x: 0, y: 0 };

                // Position painting at thumbnail location initially
                currentPainting.position.set(thumbPos.x, thumbPos.y, 0);
                currentPainting.scale.set(0.3, 0.3, 0.3);
                currentPainting.children[0].material.transparent = true;
                currentPainting.children[0].material.opacity = 0;
                currentPainting.visible = true;

                // Fade out gallery items
                galleryPaintings.forEach((p, i) => {
                    if (p && p.material) {
                        gsap.to(p.material, {
                            opacity: 0,
                            duration: 0.4,
                            ease: "power2.in"
                        });
                    }
                });

                // Animate camera to single view
                gsap.to(camera.position, {
                    x: 0,
                    y: 0,
                    z: 7,
                    duration: 1.2,
                    ease: "power3.inOut"
                });

                // Animate painting to center
                gsap.to(currentPainting.position, {
                    x: 0,
                    y: 0,
                    z: 0,
                    duration: 1.2,
                    ease: "power3.inOut"
                });

                gsap.to(currentPainting.scale, {
                    x: 1,
                    y: 1,
                    z: 1,
                    duration: 1.2,
                    ease: "power3.inOut"
                });

                gsap.to(currentPainting.children[0].material, {
                    opacity: 1,
                    duration: 0.8,
                    delay: 0.4,
                    ease: "power2.out",
                    onComplete: () => {
                        galleryGroup.visible = false;
                        galleryWall.visible = false;
                        isGalleryMode = false;
                        isAnimating = false;
                        updateUI();
                        // Re-enable shadow updates after transition
                        renderer.shadowMap.autoUpdate = false;
                        needsShadowUpdate = true;
                    }
                });

                // Move light back
                gsap.to(dynamicLight.position, {
                    z: 4,
                    duration: 1.2,
                    ease: "power3.inOut"
                });
            });
        }

        function handleGalleryClick(event) {
            if (!isGalleryMode || isAnimating) return;

            // Update mouse position
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            // Raycast to gallery paintings
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(galleryPaintings.filter(p => p), true);

            if (intersects.length > 0) {
                const clickedPainting = intersects[0].object;
                const index = clickedPainting.userData.index;
                if (index !== undefined) {
                    exitGalleryMode(index);
                }
            }
        }

        function preloadTexture(index) {
            if (index < 0 || index >= paintings.length) return;
            if (loadedTextures[index]) return;

            const painting = paintings[index];
            textureLoader.load(`Cropped/${painting.file}`, (texture) => {
                loadedTextures[index] = texture;
            });
        }

        // Single elegant animation - Swiss precision
        // One consistent motion for professional feel

        function loadPainting(index, callback) {
            const painting = paintings[index];

            const loadTexture = (texture) => {
                const aspect = texture.image.width / texture.image.height;
                // Responsive painting size - smaller on mobile to leave room for text
                const isMobile = window.innerWidth <= 768;
                const maxHeight = isMobile ? 2.0 : 3.0;
                const maxWidth = isMobile ? 2.5 : 4.0;

                let width, height;
                if (aspect > maxWidth / maxHeight) {
                    width = maxWidth;
                    height = maxWidth / aspect;
                } else {
                    height = maxHeight;
                    width = maxHeight * aspect;
                }

                const group = new THREE.Group();

                // Canvas (the painting itself)
                const canvasGeom = new THREE.PlaneGeometry(width, height);
                const canvasMat = new THREE.MeshStandardMaterial({
                    map: texture,
                    roughness: 0.7,
                    metalness: 0
                });
                const canvas = new THREE.Mesh(canvasGeom, canvasMat);
                canvas.castShadow = true;
                canvas.receiveShadow = true;
                group.add(canvas);

                // Shadow caster - thin frame depth for tight shadow
                const shadowMargin = 0.04;
                const shadowCasterGeom = new THREE.BoxGeometry(
                    width + shadowMargin * 2,
                    height + shadowMargin * 2,
                    0.06  // Depth for shadow - close to wall
                );
                const shadowCasterMat = new THREE.MeshStandardMaterial({
                    color: 0x1a1a1a,
                    transparent: true,
                    opacity: 0.0,  // Invisible but casts shadow
                    side: THREE.FrontSide
                });
                const shadowCaster = new THREE.Mesh(shadowCasterGeom, shadowCasterMat);
                shadowCaster.position.z = -0.03; // Closer to wall
                shadowCaster.castShadow = true;
                shadowCaster.receiveShadow = false;
                group.add(shadowCaster);

                group.userData = { index, painting, width, height };
                callback(group);
            };

            if (loadedTextures[index]) {
                loadTexture(loadedTextures[index]);
            } else {
                textureLoader.load(`Cropped/${painting.file}`, (texture) => {
                    loadedTextures[index] = texture;
                    loadTexture(texture);
                });
            }
        }

        function navigate(direction) {
            if (isAnimating) return;

            const newIndex = currentIndex + direction;
            if (newIndex < 0 || newIndex >= paintings.length) return;

            isAnimating = true;
            document.body.classList.add('animating');

            // Hide details panel during navigation
            document.getElementById('detailsPanel').classList.remove('visible');

            // Load new painting
            loadPainting(newIndex, (painting) => {
                nextPainting = painting;
                paintingGroup.add(nextPainting);

                // Single elegant reveal animation - Swiss precision
                const timeline = gsap.timeline({
                    onUpdate: () => {
                        needsShadowUpdate = true;
                    },
                    onComplete: () => {
                        paintingGroup.remove(currentPainting);
                        currentPainting = nextPainting;
                        currentIndex = newIndex;
                        isAnimating = false;
                        document.body.classList.remove('animating');
                        currentPainting.scale.set(1, 1, 1);
                        updateShadows();
                        preloadTexture(currentIndex - 1);
                        preloadTexture(currentIndex + 1);
                        updateUI();
                    }
                });

                // Elegant crossfade with subtle horizontal shift
                // Current painting: fade out + slight shift away
                currentPainting.children[0].material.transparent = true;
                nextPainting.children[0].material.transparent = true;
                nextPainting.children[0].material.opacity = 0;
                nextPainting.position.set(direction * 0.3, 0, 0);

                // Fade out current
                timeline.to(currentPainting.children[0].material, {
                    opacity: 0,
                    duration: 0.6,
                    ease: "power2.inOut"
                });
                timeline.to(currentPainting.position, {
                    x: direction * -0.3,
                    duration: 0.6,
                    ease: "power2.inOut"
                }, "<");

                // Fade in next
                timeline.to(nextPainting.children[0].material, {
                    opacity: 1,
                    duration: 0.6,
                    ease: "power2.inOut"
                }, "-=0.4");
                timeline.to(nextPainting.position, {
                    x: 0,
                    duration: 0.6,
                    ease: "power2.inOut"
                }, "<");

                // Update editorial elements during transition
                timeline.call(() => {
                    document.getElementById('paintingTitle').textContent = paintings[newIndex].title;
                    document.getElementById('artistPreview').textContent = paintings[newIndex].artist;
                    document.getElementById('currentNum').textContent = String(newIndex + 1).padStart(2, '0');
                }, null, "-=0.3");
            });
        }

        function updateUI() {
            const painting = paintings[currentIndex];

            // Editorial title (bottom left)
            document.getElementById('paintingTitle').textContent = painting.title;
            document.getElementById('artistPreview').textContent = painting.artist;

            // Counter (top right) - zero-padded for Swiss aesthetic
            document.getElementById('currentNum').textContent = String(currentIndex + 1).padStart(2, '0');
            document.getElementById('totalNum').textContent = String(paintings.length).padStart(2, '0');

            // Details panel (bottom right)
            document.getElementById('infoYear').textContent = painting.year;
            document.getElementById('infoMedium').textContent = painting.medium;
            document.getElementById('infoSize').textContent = painting.size;
            document.getElementById('infoCondition').textContent = painting.condition;
            document.getElementById('infoDescription').textContent = painting.description;
            document.getElementById('infoPrice').textContent = painting.price;

            // Zoom
            document.getElementById('zoomTitle').textContent = painting.title;
            document.getElementById('zoomDetails').textContent = `${painting.artist} · ${painting.year} · ${painting.medium}`;

            // Nav arrows
            document.querySelector('.nav-arrow.left').classList.toggle('disabled', currentIndex === 0);
            document.querySelector('.nav-arrow.right').classList.toggle('disabled', currentIndex === paintings.length - 1);

            // Update offer display
            updateHighestOfferDisplay();
        }

        function openZoom() {
            if (isAnimating) return;
            const painting = paintings[currentIndex];
            document.getElementById('zoomImage').src = `Cropped/${painting.file}`;
            document.getElementById('zoomOverlay').classList.add('active');
        }

        function closeZoom() {
            document.getElementById('zoomOverlay').classList.remove('active');
        }

        function setupEvents() {
            // Window resize
            let resizeTimeout;
            let lastCols = getGalleryCols();

            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);

                // Debounced resize handling
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    const newCols = getGalleryCols();
                    if (newCols !== lastCols) {
                        lastCols = newCols;
                        rebuildGalleryGrid();
                    }

                    // Reload current painting if crossing mobile breakpoint (for size adjustment)
                    const wasMobile = lastWasMobile;
                    const isMobile = window.innerWidth <= 768;
                    if (wasMobile !== isMobile && !isGalleryMode && !isAnimating) {
                        lastWasMobile = isMobile;
                        // Reload painting at new size
                        if (currentPainting) {
                            paintingGroup.remove(currentPainting);
                            loadPainting(currentIndex, (painting) => {
                                currentPainting = painting;
                                paintingGroup.add(currentPainting);
                            });
                        }
                    }
                }, 300);
            });

            let lastWasMobile = window.innerWidth <= 768;

            // Keyboard
            window.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    if (isGalleryMode) {
                        exitGalleryMode();
                    } else {
                        closeZoom();
                    }
                }
                // Navigation only in single view mode
                if (!isGalleryMode) {
                    if (e.key === 'ArrowLeft') navigate(-1);
                    if (e.key === 'ArrowRight') navigate(1);
                }
                // G key to toggle gallery
                if (e.key === 'g' || e.key === 'G') {
                    toggleGalleryMode();
                }
            });

            // Details panel hover - triggered by corner hover zone, painting hover, or panel hover
            const detailsPanel = document.getElementById('detailsPanel');
            const hoverZone = document.getElementById('hoverZone');

            // Corner hover zone
            hoverZone.addEventListener('mouseenter', () => {
                if (!isGalleryMode) {
                    detailsPanel.classList.add('visible');
                }
            });

            hoverZone.addEventListener('mouseleave', (e) => {
                if (!detailsPanel.contains(e.relatedTarget)) {
                    detailsPanel.classList.remove('visible');
                }
            });

            // Details panel itself
            detailsPanel.addEventListener('mouseenter', () => {
                detailsPanel.classList.add('visible');
            });

            detailsPanel.addEventListener('mouseleave', () => {
                detailsPanel.classList.remove('visible');
            });

            // Click handler - different behavior in gallery mode vs single view
            renderer.domElement.addEventListener('click', (event) => {
                if (isGalleryMode) {
                    handleGalleryClick(event);
                } else {
                    openZoom();
                }
            });

            // Zoom overlay click to close
            document.getElementById('zoomOverlay').addEventListener('click', (e) => {
                if (e.target === document.getElementById('zoomOverlay')) {
                    closeZoom();
                }
            });

            // Mouse move: light follows cursor, detect painting hover, subtle parallax
            window.addEventListener('mousemove', (e) => {
                // Update mouse position for raycasting
                mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;

                // Light follows cursor - but NOT during transitions to prevent flickering
                if (!isAnimating) {
                    const lightRange = isGalleryMode ? 15 : 6;
                    const lightX = (e.clientX / window.innerWidth - 0.5) * lightRange;
                    const lightY = (e.clientY / window.innerHeight - 0.5) * -lightRange * 0.6 + 1;

                    gsap.to(dynamicLight.position, {
                        x: lightX,
                        y: lightY,
                        duration: 0.3,
                        ease: "power2.out",
                        onUpdate: () => {
                            needsShadowUpdate = true;
                        }
                    });
                }

                // Gallery mode hover detection
                if (isGalleryMode && !isAnimating) {
                    raycaster.setFromCamera(mouse, camera);
                    const intersects = raycaster.intersectObjects(galleryPaintings.filter(p => p), true);

                    if (intersects.length > 0) {
                        document.body.classList.add('hovering-painting');
                        // Subtle scale on hover
                        const hoveredPainting = intersects[0].object;
                        galleryPaintings.forEach((p, i) => {
                            if (p && p !== hoveredPainting) {
                                gsap.to(p.scale, { x: 1, y: 1, duration: 0.3 });
                            }
                        });
                        gsap.to(hoveredPainting.scale, { x: 1.08, y: 1.08, duration: 0.3 });
                    } else {
                        document.body.classList.remove('hovering-painting');
                        galleryPaintings.forEach((p) => {
                            if (p) gsap.to(p.scale, { x: 1, y: 1, duration: 0.3 });
                        });
                    }
                }

                // Single view - detect if hovering over painting
                if (!isGalleryMode && currentPainting && !isAnimating) {
                    raycaster.setFromCamera(mouse, camera);
                    const intersects = raycaster.intersectObjects(currentPainting.children, true);

                    if (intersects.length > 0) {
                        // Hovering over painting - show details and click hint
                        detailsPanel.classList.add('visible');
                        document.getElementById('clickHint').classList.add('visible');
                    } else {
                        // Not hovering over painting
                        if (!detailsPanel.matches(':hover')) {
                            detailsPanel.classList.remove('visible');
                        }
                        document.getElementById('clickHint').classList.remove('visible');
                    }
                }

                // Subtle camera parallax (only in single view mode)
                if (!isAnimating && !isGalleryMode) {
                    const camX = (e.clientX / window.innerWidth - 0.5) * 0.05;
                    const camY = (e.clientY / window.innerHeight - 0.5) * 0.03;

                    gsap.to(camera.position, {
                        x: camX,
                        y: -camY,
                        duration: 1.5,
                        ease: "power2.out"
                    });
                }
            });

            // Hide details when mouse leaves window
            document.addEventListener('mouseleave', () => {
                detailsPanel.classList.remove('visible');
                document.getElementById('clickHint').classList.remove('visible');
            });

            // ==================== TOUCH/SWIPE SUPPORT ====================

            // Touch start
            renderer.domElement.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
                isSwiping = false;
            }, { passive: true });

            // Touch move - detect swipe
            renderer.domElement.addEventListener('touchmove', (e) => {
                if (!touchStartX) return;

                touchEndX = e.touches[0].clientX;
                const diffX = touchStartX - touchEndX;
                const diffY = Math.abs(touchStartY - e.touches[0].clientY);

                // Only swipe if horizontal movement > vertical
                if (Math.abs(diffX) > 30 && Math.abs(diffX) > diffY) {
                    isSwiping = true;
                }
            }, { passive: true });

            // Touch end - execute swipe or tap
            renderer.domElement.addEventListener('touchend', (e) => {
                if (isSwiping && !isGalleryMode) {
                    const diffX = touchStartX - touchEndX;
                    if (diffX > 50) {
                        // Swipe left - next painting
                        navigate(1);
                    } else if (diffX < -50) {
                        // Swipe right - previous painting
                        navigate(-1);
                    }
                } else if (!isSwiping) {
                    // It was a tap, not a swipe
                    if (isGalleryMode) {
                        // Handle gallery tap
                        const touch = e.changedTouches[0];
                        mouse.x = (touch.clientX / window.innerWidth) * 2 - 1;
                        mouse.y = -(touch.clientY / window.innerHeight) * 2 + 1;
                        raycaster.setFromCamera(mouse, camera);
                        const intersects = raycaster.intersectObjects(galleryPaintings.filter(p => p), true);

                        if (intersects.length > 0) {
                            const index = intersects[0].object.userData.index;
                            if (index !== undefined) {
                                exitGalleryMode(index);
                            }
                        }
                    } else {
                        // Toggle details panel on tap (mobile)
                        if ('ontouchstart' in window) {
                            detailsPanel.classList.toggle('visible');
                        }
                    }
                }

                // Reset
                touchStartX = 0;
                touchStartY = 0;
                touchEndX = 0;
                isSwiping = false;
            }, { passive: true });

            // Prevent default touch behaviors that might interfere
            renderer.domElement.addEventListener('touchmove', (e) => {
                if (isSwiping) {
                    e.preventDefault();
                }
            }, { passive: false });
        }

        // Shadow update flag for optimization
        let needsShadowUpdate = true;

        function updateShadows() {
            needsShadowUpdate = true;
        }

        // ==================== OFFER SYSTEM ====================

        // Load offers from localStorage
        let allOffers = JSON.parse(localStorage.getItem('paintingOffers') || '{}');

        function getHighestOffer(paintingFile) {
            const offers = allOffers[paintingFile] || [];
            if (offers.length === 0) return null;
            return Math.max(...offers.map(o => o.amount));
        }

        function updateHighestOfferDisplay() {
            const painting = paintings[currentIndex];
            const highest = getHighestOffer(painting.file);
            const el = document.getElementById('highestOffer');

            if (highest) {
                el.innerHTML = `Current highest offer: <span>€ ${highest.toLocaleString()}</span>`;
            } else {
                el.innerHTML = 'Be the first to make an offer';
            }
        }

        function openOfferModal() {
            const painting = paintings[currentIndex];
            document.getElementById('offerPaintingTitle').textContent = painting.title;
            document.getElementById('offerPaintingDetails').textContent = `${painting.artist} - ${painting.medium}`;

            // Reset form
            document.getElementById('offerForm').reset();
            document.getElementById('offerFormContainer').style.display = 'block';
            document.getElementById('offerSuccessContainer').style.display = 'none';

            // Pre-fill suggested amount based on asking price
            const askingPrice = parseInt(painting.price.replace(/[^0-9]/g, '')) || 1000;
            document.getElementById('offerAmount').placeholder = `Asking: € ${askingPrice.toLocaleString()}`;

            document.getElementById('offerModal').classList.add('active');
        }

        function closeOfferModal() {
            document.getElementById('offerModal').classList.remove('active');
        }

        function submitOffer(event) {
            event.preventDefault();

            const painting = paintings[currentIndex];
            const email = document.getElementById('offerEmail').value;
            const amount = parseInt(document.getElementById('offerAmount').value);
            const name = document.getElementById('offerName').value || 'Anonymous';

            // Create offer object
            const offer = {
                email,
                amount,
                name,
                paintingTitle: painting.title,
                paintingFile: painting.file,
                timestamp: new Date().toISOString()
            };

            // Save to localStorage
            if (!allOffers[painting.file]) {
                allOffers[painting.file] = [];
            }
            allOffers[painting.file].push(offer);
            localStorage.setItem('paintingOffers', JSON.stringify(allOffers));

            // Show success message
            document.getElementById('confirmEmail').textContent = email;
            document.getElementById('offerFormContainer').style.display = 'none';
            document.getElementById('offerSuccessContainer').style.display = 'block';

            // Update display
            updateHighestOfferDisplay();

            // Log offer (in production, this would be sent to a server)
            console.log('New offer submitted:', offer);

            // Close modal after delay
            setTimeout(() => {
                closeOfferModal();
            }, 3000);
        }

        // Close modal on click outside
        document.getElementById('offerModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('offerModal')) {
                closeOfferModal();
            }
        });

        function animate() {
            requestAnimationFrame(animate);

            // Only update shadows when needed (after animation settles)
            if (needsShadowUpdate) {
                renderer.shadowMap.needsUpdate = true;
                needsShadowUpdate = false;
            }

            renderer.render(scene, camera);
        }

        // Start
        init();
    </script>
</body>
</html>
